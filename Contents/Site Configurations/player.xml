<!--
    DO NOT EDIT THIS FILE
    It was generated from a template.  Your changes will be overwritten
-->
<!DOCTYPE site SYSTEM "http://dev.plexapp.com/docs/_static/siteconfig.dtd"> 
<site site="http://mlb.mlb.com"
    plugin="http://mlb.mlb.com/flash/mediaplayer/v4.1/R9/MediaPlayer4.swf"
    identifier="com.plexapp.plugins.mlb"
    initialState="loading"
    version="0.3.2">

    <crop x="0" y="102" width="800" height="450" />

    <!-- halt -->
    <state name="halt"/>

    <!-- initial, loading state -->
    <state name="loading">
        <event>
            <condition><condition name="loaded"/></condition>
            <action><goto state="loaded"/></action>
        </event>
    </state>

    <!-- try to determine which state it's in -->
    <state name="loaded">
        <event>
            <condition>
                <and>
                    <condition name="prompting-for-login"/>
                    <not>
                        <condition name="logged-in"/>
                    </not>
                </and>
            </condition>
            <action><goto state="login"/></action>
        </event>

        <event>
            <condition>
                <and>
                    <condition name="playing-audio"/>
                </and>
            </condition>
            <action><goto state="playing-audio"/></action>
        </event>

        <event>
            <condition>
                <and>
                    <condition name="playing-video"/>
                </and>
            </condition>
            <action><goto state="playing-video"/></action>
        </event>
    </state>

    <state name="login">
        <event>
            <condition>
                <and>
                    <pref name="login" exists="true"/>
                    <pref name="password" exists="true"/>
                </and>
            </condition>
            <action>
                <!-- set focus -->
                <click x="267" y="293"/>
                <pause time="10"/>

                <!-- "double click" the email input to select all -->
                <click x="267" y="293"/>
                <click x="267" y="293"/>
                <pause time="100"/>
                <type text="${login}"/>

                <!-- click the password input -->
                <pause time="10"/>
                <click x="267" y="323"/>
                <pause time="100"/>
                <type text="${password}"/>

                <!-- submit the form -->
                <pause time="100"/>
                <type key="13"/>

                <!-- might as well give it some time to log in -->
                <pause time="3000"/>

                <goto state="waiting-for-login-result"/>
            </action>
        </event>
    </state>

    <state name="playing-audio">
        <event>
            <condition>
                <or>
                    <command name="play"/>
                    <command name="pause"/>
                </or>
            </condition>
            <action>
                <move x="400" y="400"/>
                <pause time="100"/>
                <click x="400" y="400"/>
                <move x="0" y="0"/>
            </action>
        </event>
    </state>

    <state name="playing-video">
        <event>
            <condition>
                <or>
                    <command name="play"/>
                    <command name="pause"/>
                </or>
            </condition>
            <action>
                <move x="219" y="528"/>
                <pause time="100"/>
                <click x="219" y="528"/>
                <move x="0" y="0"/>
            </action>
        </event>
    </state>

    <state name="waiting-for-login-result">
        <event>
            <condition><condition name="logged-in"/></condition>
            <action><goto state="loaded"/></action>
        </event>
        <event>
            <condition><condition name="login-error"/></condition>
            <action><goto state="halt"/></action>
        </event>
    </state>

    <condition name="loaded">
        <and>
            <!-- header logo loaded -->
            <color x="27"  y="33" rgb="3561a3"/>
            <color x="171" y="33" rgb="c82129"/>
            <color x="27"  y="59" rgb="214b93"/>
            <color x="171" y="59" rgb="c82129"/>
        </and>
    </condition>

    <condition name="logged-in">
        <and>
            <condition name="loaded"/>

            <!-- "welcome back" text -->
            <color x="13" y="9" rgb="ebebeb"/>
            <color x="58" y="9" rgb="efefef"/>
        </and>
    </condition>

    <condition name="login-error">
        <and>
            <!-- error text -->
            <color x="212" y="223" rgb="9e0b19"/>
            <color x="330" y="223" rgb="8b111c"/>
        </and>
    </condition>

    <condition name="playing-audio">
        <and>
            <condition name="logged-in"/>
            <color x="244" y="238" rgb="505050"/>
            <color x="550" y="238" rgb="282828"/>
            <color x="244" y="430" rgb="030303"/>
            <color x="550" y="430" rgb="030303"/>
        </and>
    </condition>

    <condition name="playing-video">
        <and>
            <condition name="logged-in"/>
            <not>
                <condition name="playing-audio"/>
            </not>
        </and>
    </condition>

    <condition name="prompting-for-login">
        <and>
            <condition name="loaded"/>

            <!-- email field -->
            <color x="267" y="293" rgb="d7d7d7" op="brighter-than"/>
            <color x="371" y="276" rgb="d7d7d7" op="brighter-than"/>
            <!-- password field -->
            <color x="267" y="323" rgb="d7d7d7" op="brighter-than"/>
            <color x="371" y="306" rgb="d7d7d7" op="brighter-than"/>
        </and>
    </condition>
</site>